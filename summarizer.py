import os
import json
from haystack import Pipeline
from haystack.utils import Secret
from haystack.components.generators import OpenAIGenerator
from haystack.components.builders.prompt_builder import PromptBuilder


prompt_template = """
You are an expert journalist and curator about AI  (Artificial Intelligence) and music.

Check if the given story discusses AI (Artificial Intelligence) and 
music together. Specifically, look for topics that involve AI being used in music creation, composition, production, analysis, or performance.

If check is "Yes", return as a summary a catchy, compelling and short description that highlights the key points about AI and music.

If the check is "No", return "off-topic" as summary.

Story: '''{{story}}'''

Return a json with the fields "check" and "summary".
"""

api_key = Secret.from_token(os.getenv("OPENAI_API_KEY").strip("\""))
prompt_builder = PromptBuilder(template=prompt_template)
llm = OpenAIGenerator(api_key=api_key, model="gpt-4o-mini")

pipeline = Pipeline()
pipeline.add_component("prompt_builder", prompt_builder)
pipeline.add_component("llm", llm)
pipeline.connect("prompt_builder", "llm")

def filter_and_summarize_ai_music(story: str) -> json:
    results = pipeline.run(
        {
            "prompt_builder": {
                "story": story
            },
        }
    )   
    result = results["llm"]["replies"][0].strip("```").strip("json")
    return json.loads(result)

if __name__ == "__main__":
    story = "HomeLive Concert IndustryAre We There Yet? How Area4Labs Is Utilizing AI to Highlight Our Vibrant Grassroots Music SceneKaren ElliottAugust 29, 2024SaveSavePhoto generated by AI.AI is full of theoretical hype — but Area4Labs is applying AI to construct real solutions for mapping live shows.The following comes from Area4Labs, the company behindHearbyand a fast-emerging player in concert discovery.Area4Labs has been diving headfirst into AI and sifting through lots of theoretically exciting possibilities. But we’re also crafting concrete solutions attracting serious partnerships and changing the game for show listings and concert discovery. In this article, I’ll give you a breakdown of what we’re building right now via our discovery platform and app,Hearby.About three years ago, we started applying AI to our favorite challenges—identifying bands playing at events and creating a general-purpose event website scraper. In retrospect, these problems were enticing, but they were too ambitious for the tech available at that time, plus we had a lot of learning to do first.Now that we have some mileage, we’re working on expanded versions of these same capabilities: how to find events (acquisition) and how to know what they really are (classification). Finding events incorporates an LLM, and classification uses a statistical model. We are also revisiting our neural net-based band identification project.All over the world, organizations are sorting hype from reality and devising ways to avoid or fill shortfalls to get real work done now.GPT-4 is deeply impressive, but getting it to do something fact-oriented and useful is a challenge. For example, asking it for “best venues in Boston” will get you a partial and out-of-date list. It’s a beautiful list, but it also includes closed venues and doesn’t tell you what’s on tonight. To add a human touch, it will throw over to the actual human-curated ‘Best of Lists,’ which is okay as a compilation of knowledge but nothing you couldn’t have found by Googling.Hardware to train these models on is prohibitively expensive, leaving this in the hands of mega-corporations like Google, Facebook,OpenAI, and Amazon, not to mention the difficulty of acquiring clean, ethically procured data.However, those closed doors are now opening due to the (relatively) recent advancement of incremental training. As a result, general-purpose models can be created by a large organization, then acquired by smaller groups and fine-tuned to meet special interests or needs.I’ll be sharing some observations as we grapple with these problems, starting with:It’s not as great as you thinkYou need clean data to learn on (and lots of it)The chasm of supervised vs. unsupervisedThe bizarre job you’ve never heard of: ‘Prompt Engineer’First observation: It’s not as great as you thinkAI can both perform impressive tasks and fail at simple things a 5-year-old (or a dog) could manage. Frustratingly, sometimes ChatGPT gives a coherent, useful answer, but sometimes it just gives back junk or simply refuses to answer.It seems simple to hook in a database of facts, but this crosses two paradigms: computer-based information and human-like language. So, the challenge, as it is with humans, is to describe a database or task in human language. This task is exactly as clumsy as it sounds, as we all know from trying to explain something complex to another person.Second observation: You need clean data to learn on (and lots of it).Models need to learn on already cleaned and categorized data, which is hard to find and trust. This data needs to be ethically obtained. In the volume that is needed—millions of data points—this is prohibitive. LLMs provide a pre-trained model that can be adapted and/or expanded, which lightens this load but doesn’t remove it.Thirdly: supervised vs. unsupervisedSupervised learning vs. unsupervised simply means whether the model is trained on categorized data (i.e. the correct answer is known) or left to figure it out more randomly.Finding events is relatively simple—we start by looking where we know we will find music events, such as ticketing APIs, scraping venue websites, or understanding the weekly or monthly schedules of small venues.But what about events that are promoted alone and without context? A café poster or a Google result? An API event that is not categorized? Is it music, theater, sports, or family?If you see “AC/DC versus Led Zeppelin,” you know exactly what that is — what kind of music, and probably what kind of venue, crowd, and vibe it involves. And if you see “Arsenal versus Manchester United,” you also know precisely what that is. But pity the AI that must figure that out.The challenge is to gather enough events and bands and fully understand them, including what kinds of events are happening and what type of band is playing what—then use this information to train a Machine Learning model. Complicating matters is that music scenes vary by city and even genre. In the UK, tribute bands are popular; in the US, less so. A model trained on New York City will probably be less accurate in connecting and categorizing bands in Manchester.Lastly, the bizarre job you’ve never heard of: ‘Prompt Engineer’As a lifelong programmer, the need to translate ideas, concepts, and requirements into natural human language to get the best results out of an LLM like ChatGPT is most unnatural to me. I’m used to doing this in various computer languages, but the opposite is odd. I recently saw a fascinating piece of AI art, which I can only describe as a beautiful feathered orange flying chicken woman. Only in 2024 do these words even go together.But how was this art created? An AI artist designed a prompt specifying exactly the type and tone of image wanted. The resulting art is captivating and unique.For more software-like needs, this is the Prompt Engineer job. They come up with a ChatGPT prompt that specifies not only what is wanted but also how to get it and what tone to use. With LLMs, just like the genie in the bottle, you will (probably) get what you ask for, and it may surprise you.As a first step in this area, we started with text-to-SQL, meaning we needed to phrase a computer problem as a human language directive so that a computer could “understand” it in its language-oriented structures. For our usage, a prompt might be:“Find events by looking in the Event database table by location, then looking up the venue in the Venue table. Pay special attention to the city and be sure not to confuse city with band name as they are sometimes the same. It is very important to return the soonest results first. Return the results in the style of a friendly guidebook.”If you think about it, formulating a problem in human language so that a computer can understand it is a pretty ironic job. We are currently working on ways to optimize our database for this chat usage, including looking at OpenSearch and vector databases.As we explore this more and sometimes hit frustrating walls with this incredible technology, I try to remember that we’re in a growth phase, and growth is not linear. Learning is messy, but the end results will be worth it.I am delighted by the possibilities that AI has as a useful tool to improve our lives and optimistic that we can use it to elevate grassroots music.Share on:FacebookTwitterLinkedInCopy LinkRelated PostsDMN Pro ExclusiveSaveMusic Industry Funding Has Topped $360 Million During the Past Month Alone — What Are Investors Betting On?Paul ResnikoffSeptember 18, 2024DMN Pro ExclusiveSaveIs It Time to Turn Off Ad-Supported Streaming? Breaking Down the Multibillion-Dollar Question Amid Slowing Subscription GrowthPaul ResnikoffSeptember 11, 2024SaveLyte Faces Multiple Lawsuits from Festival Organizers Over Alleged Breach of Contract, Fraud, and Missing PaymentsDylan SmithSeptember 24, 2024SaveIron Maiden Says No to Dynamic Pricing — With Resale Values Also CappedAshley KingSeptember 24, 2024"
    summarised = filter_and_summarize_ai_music(story)
    print(summarised)